-- Load WindUI
local WindUI = loadstring(game:HttpGet("https://github.com/Footagesus/WindUI/releases/latest/download/main.lua"))()

-- Anti-Cheat Bypass (placed safely)
task.spawn(function()
    local success, err = pcall(function()
        local mt = getrawmetatable(game)
        if setreadonly then setreadonly(mt, false) end

        local oldIndex = mt.__index
        local oldNamecall = mt.__namecall

        local spoofed = {
            WalkSpeed = 16,
            JumpPower = 50
        }

        mt.__index = newcclosure(function(self, key)
            if self:IsA("Humanoid") and spoofed[key] then
                return spoofed[key]
            end
            return oldIndex(self, key)
        end)

        mt.__namecall = newcclosure(function(self, ...)
            local method = getnamecallmethod()
            local args = {...}

            -- Block anti-cheat remotes
            local name = tostring(self):lower()
            if method == "FireServer" and (name:find("log") or name:find("tele") or name:find("anti")) then
                return
            end

            return oldNamecall(self, unpack(args))
        end)

        local Players = game:GetService("Players")
        local lp = Players.LocalPlayer
        lp.CharacterAdded:Connect(function(char)
            local hum = char:WaitForChild("Humanoid")
            hum:GetPropertyChangedSignal("WalkSpeed"):Connect(function()
                spoofed.WalkSpeed = hum.WalkSpeed
            end)
            hum:GetPropertyChangedSignal("JumpPower"):Connect(function()
                spoofed.JumpPower = hum.JumpPower
            end)
        end)
    end)
    if not success then
        warn("Vex is Best!")
    end
end)

-- Get player info
local player = game.Players.LocalPlayer
local playerName = player.Name
local playerDisplayName = player.DisplayName

-- Get the game name dynamically
local MarketplaceService = game:GetService("MarketplaceService")
local gameName = MarketplaceService:GetProductInfo(game.PlaceId).Name

-- Create Window with dynamic game name
local Window = WindUI:CreateWindow({
    Title = "VEX - " .. gameName,
    Author = "Premium Build",
    Icon = "rbxassetid://86958834463274",
    Folder = "Vex " .. gameName,
    Size = UDim2.fromOffset(500, 350),
    Transparent = false,
    Theme = "Dark",
    HidePanelBackground = true,
    NewElements = false,
    Acrylic = false,
    HideSearchBar = true,
    SideBarWidth = 200,
})

Window:EditOpenButton({
    Enabled = false
})

task.delay(13, function()
    WindUI:Notify({
        Title = "VEX",
        Content = "Join our Discord to get more of the best scripts!",
        Icon = "users",
        Duration = 6
    })
end)

-- Tabs
local Tabs = {
    Discord = Window:Tab({ Title = "Discord", Icon = "users" }),
    Main = Window:Tab({ Title = "Main", Icon = "flame" }),
    Player = Window:Tab({ Title = "Player", Icon = "user" }),
}

-- Discord Section
Tabs.Discord:Section({ Title = "Community" })

Tabs.Discord:Paragraph({
    Title = "Discord",
    Desc = "Join our Discord to get more of the best scripts and updates!",
    Image = "rbxassetid://82233980503615",
    ImageSize = 60,
    Color = "Red",
    Buttons = {
        {
            Title = "Copy Invite",
            Icon = "copy",
            Variant = "Tertiary",
            Callback = function()
                setclipboard("https://discord.gg/FvMePtyJrq")
                WindUI:Notify({
                    Title = "Copied!",
                    Content = "Discord invite copied to clipboard",
                    Duration = 5,
                    Icon = "clipboard-check",
                })
            end
        }
    }
})

-- Player setup
local Players = game:GetService("Players")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")

-- Godmode implementation
local killTags = {"kill", "laser", "death", "lava"}
local godmodeOn = false
local connections = {}

local function isKillPart(part)
    if part:IsA("BasePart") then
        local name = part.Name:lower()
        for _, tag in ipairs(killTags) do
            if name:find(tag) then
                return true
            end
        end
    end
    return false
end

local function applyGodmode(enabled)
    for _, conn in ipairs(connections) do
        pcall(function()
            conn:Disconnect()
        end)
    end
    connections = {}

    if enabled then
        player.CharacterAdded:Connect(function(char)
            character = char
            humanoid = char:WaitForChild("Humanoid")
        end)

        table.insert(connections, humanoid:GetPropertyChangedSignal("Health"):Connect(function()
            if humanoid.Health <= 0 then
                humanoid.Health = 100
            end
        end))

        for _, part in ipairs(workspace:GetDescendants()) do
            if isKillPart(part) then
                local conn = part.Touched:Connect(function(hit)
                    if hit:IsDescendantOf(character) then
                        humanoid.Health = humanoid.Health
                    end
                end)
                table.insert(connections, conn)

                part.CanTouch = true
                part.Transparency = 0
                part.Material = Enum.Material.Neon
            end
        end
    else
        connections = {}
    end
end

------------------------------------------------------------------
-- âœ… NEW INFINITE JUMP SYSTEM (PC + MOBILE)
------------------------------------------------------------------

local UIS = game:GetService("UserInputService")
local infiniteJumpsEnabled = false
local pcConnection = nil
local mobileConnection = nil

local function doInfiniteJump()
    local char = player.Character
    if not char then return end

    local hum = char:FindFirstChild("Humanoid")
    local root = char:FindFirstChild("HumanoidRootPart")

    if not hum or not root then return end

    hum.Jump = true

    local vel = root.Velocity
    root.Velocity = Vector3.new(vel.X, 45, vel.Z)
end

local function setupInfiniteJumps(enabled)
    if pcConnection then pcConnection:Disconnect() pcConnection = nil end
    if mobileConnection then mobileConnection:Disconnect() mobileConnection = nil end

    if enabled then
        -- PC space key
        pcConnection = UIS.InputBegan:Connect(function(input, gp)
            if gp or not infiniteJumpsEnabled then return end
            if input.KeyCode == Enum.KeyCode.Space then
                doInfiniteJump()
            end
        end)

        -- MOBILE jump button
        mobileConnection = UIS.JumpRequest:Connect(function()
            if infiniteJumpsEnabled then
                doInfiniteJump()
            end
        end)
    end
end

player.CharacterAdded:Connect(function()
    task.wait(0.5)
    if infiniteJumpsEnabled then
        setupInfiniteJumps(true)
    end
end)

------------------------------------------------------------------

-- Main Tab Section
Tabs.Main:Section({ Title = "Main Features" })

-- Godmode Toggle
Tabs.Main:Toggle({
    Title = "Godmode",
    Desc = "Makes you immune to all lasers",
    Value = false,
    Callback = function(state)
        godmodeOn = state
        applyGodmode(state)

        WindUI:Notify({
            Title = "Godmode",
            Content = state and "You are immune to all lasers!" or "Disabled",
            Duration = 4,
            Icon = state and "shield" or "shield-off"
        })
    end
})

-- Infinite Jumps Toggle
Tabs.Main:Toggle({
    Title = "Infinite Jumps",
    Desc = "Jump unlimited times in mid-air",
    Value = false,
    Callback = function(state)
        infiniteJumpsEnabled = state
        setupInfiniteJumps(state)

        WindUI:Notify({
            Title = "Infinite Jumps",
            Content = state and "Enabled!" or "Disabled",
            Duration = 4,
            Icon = state and "wind" or "wind-off"
        })
    end
})

-- Teleport to Top (Auto Win)
Tabs.Main:Button({
    Title = "Teleport to Top",
    Desc = "Use this after timer crosses 6:00",
    Callback = function()
        local character = player.Character or player.CharacterAdded:Wait()
        local hrp = character:FindFirstChild("HumanoidRootPart")
        local topPlatform, highestY = nil, 0

        for _, part in ipairs(workspace:GetDescendants()) do
            if part:IsA("BasePart") and part.Anchored and part.CanCollide then
                local isFlat = part.Size.Y <= 4
                local isWide = part.Size.X >= 8 and part.Size.Z >= 8
                local isHighEnough = part.Position.Y > 100

                if isFlat and isWide and isHighEnough and part.Position.Y > highestY then
                    highestY = part.Position.Y
                    topPlatform = part
                end
            end
        end

        if hrp and topPlatform then
            local offset = topPlatform.CFrame.LookVector * -5 + topPlatform.CFrame.RightVector * 2 + Vector3.new(0, 2.5, 0)
            hrp.CFrame = CFrame.new(topPlatform.Position + offset)

            WindUI:Notify({
                Title = "Teleport Successful",
                Content = "Teleported to top platform!",
                Duration = 4,
                Icon = "map-pin"
            })
        else
            WindUI:Notify({
                Title = "Teleport Failed",
                Content = "Could not find top platform.",
                Duration = 4,
                Icon = "alert-circle"
            })
        end
    end
})

-- Player Tab Section
Tabs.Player:Section({ Title = "Movement Settings" })

-- WalkSpeed Slider
local walkSpeedValue = 16
Tabs.Player:Slider({
    Title = "WalkSpeed",
    Desc = "Adjust your character's walking speed",
    Step = 1,
    Value = {
        Min = 16,
        Max = 100,
        Default = 16,
    },
    Callback = function(value)
        walkSpeedValue = value
        local char = player.Character or player.CharacterAdded:Wait()
        local humanoid = char:FindChildWhichIsA("Humanoid")
        if humanoid then
            humanoid.WalkSpeed = value
            WindUI:Notify({
                Title = "Speed Set",
                Content = "WalkSpeed set to " .. value,
                Duration = 3,
                Icon = "zap"
            })
        end
    end
})

-- JumpPower Slider
local jumpPowerValue = 50
Tabs.Player:Slider({
    Title = "JumpPower",
    Desc = "Adjust your character's jump power",
    Step = 5,
    Value = {
        Min = 50,
        Max = 400,
        Default = 50,
    },
    Callback = function(value)
        jumpPowerValue = value
        local char = player.Character or player.CharacterAdded:Wait()
        local humanoid = char:FindChildWhichIsA("Humanoid")
        if humanoid then
            humanoid.JumpPower = value
            WindUI:Notify({
                Title = "Jump Set",
                Content = "JumpPower set to " .. value,
                Duration = 3,
                Icon = "arrow-up"
            })
        end
    end
})

-- Floating UI button
local TweenService = game:GetService("TweenService")
local UIS = game:GetService("UserInputService")

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Parent = game.CoreGui

local ImageButton = Instance.new("ImageButton")
ImageButton.Parent = ScreenGui
ImageButton.Size = UDim2.new(0, 65, 0, 65)
ImageButton.Position = UDim2.new(0, 100, 1, -300)
ImageButton.BackgroundTransparency = 1
ImageButton.Image = "rbxassetid://82233980503615"

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 15)
UICorner.Parent = ImageButton

local WindowOpen = false
ImageButton.MouseButton1Click:Connect(function()
    local shrink = TweenService:Create(ImageButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 50, 0, 50)
    })
    local grow = TweenService:Create(ImageButton, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
        Size = UDim2.new(0, 60, 0, 60)
    })

    shrink:Play()
    shrink.Completed:Wait()
    grow:Play()

    if WindowOpen then
        Window:Close()
    else
        Window:Open()
    end
    WindowOpen = not WindowOpen
end)

local isDragging = false
local dragInput, dragStart, startPosition

local function updatePosition(input)
    local delta = input.Position - dragStart
    ImageButton.Position = UDim2.new(
        startPosition.X.Scale, startPosition.X.Offset + delta.X,
        startPosition.Y.Scale, startPosition.Y.Offset + delta.Y
    )
end

ImageButton.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 
    or input.UserInputType == Enum.UserInputType.Touch then
        isDragging = true
        dragStart = input.Position
        startPosition = ImageButton.Position

        input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                isDragging = false
            end
        end)
    end
end)

ImageButton.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement 
    or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end)

UIS.InputChanged:Connect(function(input)
    if input == dragInput and isDragging then
        updatePosition(input)
    end
end)

-- Select Discord tab first
Window:SelectTab(1)

-- Cleanup
game.Players.LocalPlayer.CharacterRemoving:Connect(function()
    if pcConnection then pcConnection:Disconnect() end
    if mobileConnection then mobileConnection:Disconnect() end
end)
